{% extends "base.html" %}{% block content %}
<div class="container mt-5">
  <h1 class="text-primary">Sets</h1>
  <div class="mb-3">
    <label for="setSearch" class="form-label text-secondary"
      >Search sets (by ID or Name)</label
    >
    <input
      type="text"
      class="form-control"
      id="setSearch"
      placeholder="Start typing to search sets..."
      autocomplete="off"
    />
  </div>
  <div class="row" id="cards-row"></div>
</div>
{% endblock %} {% block scripts %}
<script>
  let sets = [];
  let setsMap = {};

  fetch("{{ url_for('static', filename='sets.csv')}}")
    .then((response) => response.text())
    .then((data) => {
      const lines = data.split("\n");
      lines.slice(1).forEach((line) => {
        if (line.trim()) {
          const fields = line.split(",");
          const set_num = fields[0].replace(/^"|"$/g, "");
          const name = fields[1].replace(/^"|"$/g, "");
          const year = fields[2].replace(/^"|"$/g, "");
          const theme_id = fields[3].replace(/^"|"$/g, "");
          const num_parts = fields[4].replace(/^"|"$/g, "");
          const img_url = fields[5].replace(/^"|"$/g, "");
          if (set_num && name) {
            sets.push({
              set_num,
              name,
              year,
              theme_id,
              num_parts,
              img_url,
            });
            setsMap[set_num] = name;
          }
        }
      });
    });

  document.getElementById("setSearch").addEventListener("input", function () {
    const query = this.value.toLowerCase().trim();
    const row = document.getElementById("cards-row");
    row.innerHTML = "";

    if (query.length < 2) {
      return;
    }

    const filtered = sets.filter(
      (set) =>
        set.set_num.toLowerCase().includes(query) ||
        set.name.toLowerCase().includes(query)
    );

    filtered.slice(0, 20).forEach((set) => {
      const col = document.createElement("div");
      col.className = "col-lg-3 col-md-4 col-sm-6 col-12 mb-3";

      const card = document.createElement("div");
      card.className = "card border-0 shadow";
      card.style.cursor = "pointer";
      card.addEventListener("click", () => {
        window.location.href = `/sets/${set.set_num}`;
      });

      const img = document.createElement("img");
      img.src = set.img_url;
      img.alt = set.name;
      img.className = "card-img-top";
      img.style.height = "130px";
      img.style.objectFit = "cover";
      card.appendChild(img);

      const cardBody = document.createElement("div");
      cardBody.className = "card-body p-2";

      const h5 = document.createElement("h5");
      h5.className = "card-title mb-1";
      h5.textContent = set.name;
      cardBody.appendChild(h5);

      const p = document.createElement("p");
      p.className = "card-text text-muted small";
      p.textContent = `ID: ${set.set_num} | Year: ${set.year} | Parts: ${set.num_parts}`;
      cardBody.appendChild(p);

      card.appendChild(cardBody);
      col.appendChild(card);
      row.appendChild(col);
    });
  });
</script>
{% endblock %}
